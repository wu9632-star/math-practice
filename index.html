<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å‡æ¯«å‡å­¸ç¿’æ¨‚åœ’ - 6+6 å®Œå‚™ç‰ˆ</title>
    <style>
        :root { --primary: #3498db; --secondary: #e67e22; --bg: #fdfaf2; --success: #27ae60; --error: #e74c3c; --convert: #1abc9c; --advanced: #c0392b; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .app-container { width: 100%; max-width: 550px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-value { font-weight: bold; color: var(--primary); font-size: 18px; }
        .menu-title { font-weight: bold; color: #444; margin: 15px 0 5px; text-align: left; border-left: 5px solid var(--primary); padding-left: 10px; font-size: 18px; }
        .menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .menu-btn { padding: 8px; font-size: 14px; cursor: pointer; border: 2px solid #ddd; border-radius: 12px; background: white; font-weight: bold; color: #777; transition: 0.2s; height: 60px;}
        .menu-btn.selected { color: white; transform: scale(1.03); border-width: 3px; }
        .btn-conv.selected { background-color: var(--convert); border-color: #16a085; }
        .btn-calc.selected { background-color: var(--primary); border-color: #2980b9; }
        .mode-selector { display: flex; gap: 10px; margin: 15px 0; }
        .mode-btn { flex: 1; padding: 15px; border: 3px solid #ddd; border-radius: 15px; cursor: pointer; font-size: 18px; font-weight: bold; background: white; transition: 0.3s; }
        .mode-btn.active { border-color: var(--success); background: #e8f5e9; color: var(--success); }
        .mode-btn.active.adv { border-color: var(--advanced); background: #f9ebea; color: var(--advanced); }
        .box-container { display: flex; justify-content: center; align-items: center; gap: 8px; margin: 25px 0; font-size: 24px; font-weight: bold; }
        .digit-input { width: 42px; height: 55px; font-size: 30px; text-align: center; border: 2px solid #ccc; border-radius: 8px; background: #fffde7; }
        .single-input { width: 180px; height: 55px; font-size: 30px; text-align: center; border: 2px solid #ccc; border-radius: 8px; background: #fffde7; letter-spacing: 2px; }
        .unit-input { width: 80px; height: 45px; font-size: 22px; text-align: center; border: 2px solid #ccc; border-radius: 8px; }
        .vertical-calc { display: grid; grid-template-columns: 40px 110px 130px; font-size: 26px; line-height: 60px; margin: 20px auto; width: fit-content; }
        .unit-label { text-align: center; font-size: 18px; border-bottom: 2px solid #ccc; font-weight: bold; }
        .calc-input { width: 100px; font-size: 26px; text-align: right; border: 2px solid #ccc; border-radius: 8px; padding: 5px; background: #fffde7; }
        .line { grid-column: 1 / 4; border-bottom: 3px solid #333; margin: 10px 0; }
        .action { padding: 12px 25px; font-size: 18px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: white; margin: 5px; }
        .start-action { background: #2ecc71; width: 100%; font-size: 22px; padding: 15px; border-radius: 50px; border: none; color: white; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="home-screen">
        <h1>ğŸ’§ å…¬å‡æ¯«å‡å­¸ç¿’æ¨‚åœ’</h1>
        <div class="menu-title">ç¬¬ä¸€æ­¥ï¼šé¸æ“‡æ¨¡å¼</div>
        <div class="mode-selector">
            <button class="mode-btn active" id="mode-basic" onclick="setMode('basic')">åŸºç¤æ¨¡å¼<br><small>< 10å…¬å‡</small></button>
            <button class="mode-btn" id="mode-adv" onclick="setMode('adv')">é€²éšæ¨¡å¼<br><small>> 10å…¬å‡</small></button>
        </div>
        <div id="adv-config" style="display:none; background:#fff; padding:15px; border-radius:12px; margin-bottom:15px; border:1px solid #ddd;">
            <span style="font-weight:bold;">é€²éšé¡Œå…¬å‡ä¸Šé™ï¼š<span id="rangeDisplay" style="color:var(--advanced)">50</span> L</span><br>
            <input type="range" id="maxLRange" min="20" max="100" value="50" step="10" style="width:85%" oninput="document.getElementById('rangeDisplay').innerText=this.value">
        </div>
        
        <div class="menu-title">å–®å…ƒä¸€ï¼šå–®ä½æ›ç®—</div>
        <div class="menu">
            <button class="menu-btn btn-conv" id="t-c-01" onclick="toggleType('c-01')">0-1 å…¬å‡æ›æ¯«å‡</button>
            <button class="menu-btn btn-conv" id="t-c-02" onclick="toggleType('c-02')">0-2 æ¯«å‡æ›å…¬å‡</button>
            <button class="menu-btn btn-conv" id="t-c-11" onclick="toggleType('c-11')">1-1 çµ„åˆ (åˆç´š)</button>
            <button class="menu-btn btn-conv" id="t-c-12" onclick="toggleType('c-12')">1-2 çµ„åˆ (é€²éš)</button>
            <button class="menu-btn btn-conv" id="t-c-21" onclick="toggleType('c-21')">2-1 æ‹†è§£ (åˆç´š)</button>
            <button class="menu-btn btn-conv" id="t-c-22" onclick="toggleType('c-22')">2-2 æ‹†è§£ (é€²éš)</button>
        </div>

        <div class="menu-title">å–®å…ƒäºŒï¼šåŠ æ¸›è¨ˆç®—</div>
        <div class="menu">
            <button class="menu-btn btn-calc" id="t-a-0" onclick="toggleType('a-0')">0-1 åŠ æ³• (ç°¡å–®)</button>
            <button class="menu-btn btn-calc" id="t-s-0" onclick="toggleType('s-0')">0-2 æ¸›æ³• (ç°¡å–®)</button>
            <button class="menu-btn btn-calc" id="t-a-1" onclick="toggleType('a-1')">1-1 åŠ æ³• (ä¸­ç­‰)</button>
            <button class="menu-btn btn-calc" id="t-s-1" onclick="toggleType('s-1')">1-2 æ¸›æ³• (ä¸­ç­‰)</button>
            <button class="menu-btn btn-calc" id="t-a-2" onclick="toggleType('a-2')">2-1 åŠ æ³• (å›°é›£)</button>
            <button class="menu-btn btn-calc" id="t-s-2" onclick="toggleType('s-2')">2-2 æ¸›æ³• (å›°é›£)</button>
        </div>
        <button class="start-action" id="startBtn" disabled onclick="startApp()">é–‹å§‹ç·´ç¿’</button>
    </div>

    <div id="main-practice-area" style="display:none;">
        <div class="stats-grid">
            <div class="stat-item">ç¸½é¡Œæ•¸ï¼š<span id="stat-total" class="stat-value">0</span></div>
            <div class="stat-item">ä¸€æ¬¡å°±å°ï¼š<span id="stat-perfect" class="stat-value">0</span></div>
            <div class="stat-value" style="grid-column: 1/3; color:var(--error); font-size:20px; border-top:1px solid #eee; padding-top:10px;">
                ç¬¬ä¸€æ¬¡ç­”å°ç‡ï¼š<span id="stat-accuracy">0</span>%
            </div>
        </div>
        <div id="convert-screen" style="display:none; background:white; padding:30px; border-radius:20px;">
            <div id="conv-q-text" style="font-size:24px; font-weight:bold; margin-bottom:15px;"></div>
            <div class="box-container" id="conv-input-area"></div>
            <button class="action" style="background:var(--secondary);" id="conv-check" onclick="checkConvert()">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button class="action" style="background:var(--primary); display:none;" id="conv-next" onclick="generateQuestion()">ä¸‹ä¸€é¡Œ</button>
        </div>
        <div id="practice-screen" style="display:none; background:white; padding:20px; border-radius:20px;">
            <div id="calc-q-text" style="font-size:18px; font-weight:bold; margin-bottom:15px; background:#eef7ff; padding:10px; border-radius:8px;"></div>
            <div class="vertical-calc">
                <div class="unit-label"></div><div class="unit-label">å…¬å‡</div><div class="unit-label">æ¯«å‡</div>
                <div></div><div><input type="number" class="calc-input" id="ansL1"></div><div><input type="number" class="calc-input" id="ansMl1"></div>
                <div id="op-display" style="font-weight:bold; text-align:left;">+</div>
                <div><input type="number" class="calc-input" id="ansL2"></div><div><input type="number" class="calc-input" id="ansMl2"></div>
                <div class="line"></div>
                <div style="font-weight:bold; text-align:left;">=</div>
                <div><input type="number" class="calc-input" id="finalL"></div><div><input type="number" class="calc-input" id="finalMl"></div>
            </div>
            <button class="action" style="background:var(--secondary);" id="calc-check" onclick="checkCalc()">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button class="action" style="background:var(--primary); display:none;" id="calc-next" onclick="generateQuestion()">ä¸‹ä¸€é¡Œ</button>
        </div>
        <div id="feedback" style="margin-top:20px; font-size:22px; font-weight:bold; min-height:30px;"></div>
        <button class="action" style="background:#95a5a6; margin-top:30px;" onclick="location.reload()">ğŸ  å›é¦–é </button>
    </div>
</div>

<script>
    let selectedTypes = [];
    let currentMode = 'basic';
    let stats = { total: 0, perfect: 0 };
    let correctData = {};
    let isFirstTry = true;

let selectedModes = ['basic']; // ç”¨ä¾†å­˜å„²é¸ä¸­çš„æ¨¡å¼ï¼Œé è¨­é¸ä¸­åŸºç¤

function setMode(mode) {
    // 1. åˆ¤æ–·é»æ“Šçš„æ¨¡å¼æ˜¯å¦å·²ç¶“åœ¨é™£åˆ—ä¸­
    const index = selectedModes.indexOf(mode);
    
    if (index > -1) {
        // å¦‚æœå·²ç¶“é¸äº†ï¼Œå°±ç§»é™¤å®ƒï¼ˆä½†è¦ä¿è­‰è‡³å°‘ç•™ä¸€å€‹ï¼Œä¸ç„¶æœƒæ²’é¡Œç›®å‡ºï¼‰
        if (selectedModes.length > 1) {
            selectedModes.splice(index, 1);
        }
    } else {
        // å¦‚æœæ²’é¸ï¼Œå°±åŠ é€²å»
        selectedModes.push(mode);
    }
    
    // 2. æ›´æ–°æŒ‰éˆ•çš„é¡è‰²ï¼ˆCSS classï¼‰
    document.getElementById('mode-basic').classList.toggle('active', selectedModes.includes('basic'));
    document.getElementById('mode-adv').classList.toggle('active', selectedModes.includes('adv'));
    document.getElementById('mode-adv').classList.toggle('adv', selectedModes.includes('adv'));
    
    // 3. åªè¦æœ‰é¸ã€Œé€²éšã€ï¼Œå°±é¡¯ç¤ºæ‹‰æ¡¿è¨­å®š
    document.getElementById('adv-config').style.display = (selectedModes.includes('adv') ? 'block' : 'none');
}
    function toggleType(type) {
        const btn = document.getElementById('t-' + type);
        if (selectedTypes.includes(type)) {
            selectedTypes = selectedTypes.filter(t => t !== type);
            btn.classList.remove('selected');
        } else {
            selectedTypes.push(type);
            btn.classList.add('selected');
        }
        document.getElementById('startBtn').disabled = selectedTypes.length === 0;
    }

    function startApp() {
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('main-practice-area').style.display = 'block';
        generateQuestion();
    }

    function generateQuestion() {
        isFirstTry = true;
        document.getElementById('feedback').innerText = "";
        currentMode = selectedModes[Math.floor(Math.random() * selectedModes.length)];
        const type = selectedTypes[Math.floor(Math.random() * selectedTypes.length)];
        
        if (type.startsWith('c')) {
            document.getElementById('convert-screen').style.display = 'block';
            document.getElementById('practice-screen').style.display = 'none';
            setupConvertQuestion(type);
        } else {
            document.getElementById('convert-screen').style.display = 'none';
            document.getElementById('practice-screen').style.display = 'block';
            setupCalcQuestion(type);
        }
        document.querySelector(`[id$="-check"]`).style.display = 'inline-block';
        document.querySelector(`[id$="-next"]`).style.display = 'none';

        setTimeout(() => {
            const digitInputs = document.querySelectorAll('.digit-input');
            digitInputs.forEach((input, index) => {
                input.oninput = function() {
                    if (this.value.length >= 1 && index < digitInputs.length - 1) digitInputs[index+1].focus();
                };
            });
        }, 100);
    }

    function setupConvertQuestion(type) {
        const area = document.getElementById('conv-input-area');
        const qText = document.getElementById('conv-q-text');
        area.innerHTML = "";
        let l = (currentMode === 'basic') ? r(1, 9) : r(11, parseInt(document.getElementById('maxLRange').value));
        let ml, total;
        switch(type) {
            case 'c-01': qText.innerText = `${l} å…¬å‡ = ? æ¯«å‡`; total = (l * 1000).toString(); if (currentMode === 'basic') createDigitInputs(4, area); else area.innerHTML = `<input type="number" id="c-ml-single" class="single-input"> æ¯«å‡`; correctData = { mode: (currentMode === 'basic'?'digits':'single'), val: total }; break;
            case 'c-02': qText.innerText = `${l * 1000} æ¯«å‡ = ? å…¬å‡`; area.innerHTML = `<input type="number" id="c-l" class="unit-input"> å…¬å‡`; correctData = { mode: 'units', l: l, ml: 0 }; break;
            case 'c-11': case 'c-12': ml = (type === 'c-11') ? r(111, 999) : r(1, 99); qText.innerText = `${l} å…¬å‡ ${ml} æ¯«å‡ = ? æ¯«å‡`; total = (l * 1000 + ml).toString(); if (currentMode === 'basic') createDigitInputs(4, area); else area.innerHTML = `<input type="number" id="c-ml-single" class="single-input"> æ¯«å‡`; correctData = { mode: (currentMode === 'basic'?'digits':'single'), val: total.padStart(4, '0') }; break;
            case 'c-21': case 'c-22': ml = (type === 'c-21') ? r(111, 999) : r(1, 99); total = l * 1000 + ml; qText.innerText = `${total} æ¯«å‡ = ? å…¬å‡ ? æ¯«å‡`; area.innerHTML = `<input type="number" id="c-l" class="unit-input"> å…¬å‡ <input type="number" id="c-ml" class="unit-input"> æ¯«å‡`; correctData = { mode: 'units', l: l, ml: ml }; break;
        }
    }

    function createDigitInputs(num, container) {
        for (let i = 0; i < num; i++) {
            let input = document.createElement('input'); input.type = "text"; input.inputMode = "numeric"; input.maxLength = 1;
            input.className = "digit-input"; input.id = "digit-" + i;
            container.appendChild(input);
        }
        container.innerHTML += " æ¯«å‡";
    }

    function setupCalcQuestion(type) {
        document.querySelectorAll('.calc-input').forEach(i => { i.value = ""; i.style.borderColor = "#ccc"; });
        let op = type.startsWith('a') ? "+" : "-";
        let l1, l2, ml1 = 0, ml2 = 0;
        const maxLimit = (currentMode === 'basic') ? 9 : parseInt(document.getElementById('maxLRange').value);

        l1 = (op === "+") ? r(1, Math.floor(maxLimit/2)) : r(Math.floor(maxLimit/2)+1, maxLimit);
        l2 = r(1, Math.floor(maxLimit/2));

        if (type.includes('-0')) { // ä¸é€²é€€ä½
            let res = getSimpleNums(op === "+"); ml1 = res[0]; ml2 = res[1];
        } else if (type === 'a-1') { // åŠ æ³•é€²ä½
            ml1 = r(500, 950); ml2 = r(500, 950);
        } else if (type === 's-1') { // æ¸›æ³•é€€ä½ (æ™®é€š)
            ml1 = r(50, 400); ml2 = r(500, 950);
        } else if (type === 'a-2') { // åŠ æ³• (æ¹Šæ•´åƒ)
            ml1 = r(100, 900); ml2 = 1000 - ml1;
        } else if (type === 's-2') { // æ¸›æ³• (æ•´å…¬å‡å€Ÿä½)
            ml1 = 0; ml2 = r(50, 950);
        }

        document.getElementById('op-display').innerText = op;
        let t1 = l1*1000 + ml1, t2 = l2*1000 + ml2;
        let finalVal = (op === "+") ? t1+t2 : t1-t2;
        document.getElementById('calc-q-text').innerText = `${l1}å…¬å‡${ml1}æ¯«å‡ ${op} ${Math.floor(t2/1000)}å…¬å‡${t2%1000}æ¯«å‡ = ?`;
        correctData = { ansL1:l1, ansMl1:ml1, ansL2:Math.floor(t2/1000), ansMl2:t2%1000, finalL:Math.floor(finalVal/1000), finalMl:finalVal%1000 };
    }

    function checkConvert() {
        let ok = true;
        if (correctData.mode === 'digits') {
            for (let i = 0; i < 4; i++) {
                let el = document.getElementById('digit-' + i);
                if (el.value === correctData.val[i]) el.style.borderColor = "var(--success)";
                else { el.style.borderColor = "var(--error)"; ok = false; }
            }
        } else if (correctData.mode === 'single') {
            let el = document.getElementById('c-ml-single');
            if (parseInt(el.value || 0) === parseInt(correctData.val)) el.style.borderColor = "var(--success)";
            else { el.style.borderColor = "var(--error)"; ok = false; }
        } else {
            let lEl = document.getElementById('c-l'), mlEl = document.getElementById('c-ml');
            if (parseInt(lEl.value || 0) === correctData.l) lEl.style.borderColor = "var(--success)";
            else { lEl.style.borderColor = "var(--error)"; ok = false; }
            if (mlEl && parseInt(mlEl.value || 0) !== correctData.ml) { mlEl.style.borderColor = "var(--error)"; ok = false; }
            else if (mlEl) mlEl.style.borderColor = "var(--success)";
        }
        processResult(ok, 'conv');
    }

    function checkCalc() {
        let ok = true;
        for (let key in correctData) {
            let el = document.getElementById(key);
            if (parseInt(el.value || 0) === correctData[key]) el.style.borderColor = "var(--success)";
            else { el.style.borderColor = "var(--error)"; ok = false; }
        }
        processResult(ok, 'calc');
    }

    function processResult(isCorrect, mode) {
        if (isFirstTry) { stats.total++; if (isCorrect) stats.perfect++; isFirstTry = false; }
        updateStats();
        let fb = document.getElementById('feedback');
        if (isCorrect) { fb.innerText = "â­• æ­£ç¢ºï¼"; fb.style.color = "var(--success)"; document.getElementById(mode + '-next').style.display = 'inline-block'; document.getElementById(mode + '-check').style.display = 'none'; }
        else { fb.innerText = "âŒ å†æª¢æŸ¥çœ‹çœ‹ï¼"; fb.style.color = "var(--error)"; }
    }

    function updateStats() {
        document.getElementById('stat-total').innerText = stats.total;
        document.getElementById('stat-perfect').innerText = stats.perfect;
        let acc = (stats.total === 0) ? 0 : Math.round((stats.perfect / stats.total) * 100);
        document.getElementById('stat-accuracy').innerText = acc;
    }

    function getSimpleNums(isAdd) {
        let a = "", b = "";
        for(let i=0; i<3; i++) {
            let d1 = r(1, 4); let d2 = isAdd ? r(1, 4) : r(1, d1);
            a += d1; b += d2;
        }
        return [parseInt(a), parseInt(b)];
    }

    function r(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
</script>
</body>
</html>
